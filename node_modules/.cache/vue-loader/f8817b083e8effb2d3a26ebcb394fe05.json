{"remainingRequest":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\src\\components\\subscribe_page.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\src\\components\\subscribe_page.vue","mtime":1614173367758},{"path":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1614173245723},{"path":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\node_modules\\babel-loader\\lib\\index.js","mtime":1614173232865},{"path":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1614173245723},{"path":"D:\\GH_Portfolio\\geonhee_inroduce\\GH_introduce_simple_web\\node_modules\\vue-loader\\lib\\index.js","mtime":1614173343246}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCi8vIO2MjOydtOyWtOuyoOydtOyKpOyXkOyEnCBvU3Vic2NyaXB0aW9uc2luREIg6rCd7LK0IOuzgOyImCDqsIDsoLjsmLQKaW1wb3J0IHsKICBvU3Vic2NyaXB0aW9uc2luREIKfSBmcm9tICdAL2RhdGFzb3VyY2VzL2ZpcmViYXNlJwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBiTXNnOiBmYWxzZSwgLy8g67KE7Yq87J20IOuIjOuguOydhCDrlYwg7JWI64K0IOuplOyLnOyngCDtkZzsi5zsl6zrtoAKICAgIH0KICB9LAogIG1ldGhvZHM6IHsKICAgIGZuUHVzaFN1YnNjcmliZSgpIHsKICAgICAgLy8gdGhpc+ydmCDqsJIg7J6E7IucIOyggOyepQogICAgICBsZXQgdGVtcF90aGlzID0gdGhpcwogICAgICAvLyDsgqzsmqnsnpDsl5Dqsowg7ZG47IucIOyCrOyaqe2VoOyngCDtl4jqsIAg7JqU7LKtCiAgICAgIE5vdGlmaWNhdGlvbi5yZXF1ZXN0UGVybWlzc2lvbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgaWYgKHJlc3VsdCAhPT0gJ2dyYW50ZWQnKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygn7ZG47Iuc7JWM66a8IOq4sOuKpeydtCDtl4jsmqnrkJjsp4Ag7JWK7JWY7Iq164uI64ukIScpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIC8vIOyCrOyaqeyekOqwgCDtl4jqsIDtlZjrqbQg7ZG47Iuc7JWM66a8IOyEnOu5hOyKpCDshKTsoJUg7Iuk7ZaJCiAgICAgICAgICB0ZW1wX3RoaXMuZm5Db25maWd1cmVQdXNoU3ViKCkKICAgICAgICB9CiAgICAgIH0pCiAgICB9LAogICAgLy8g7ZG47Iuc7JWM66a87J2EIOychO2VtCDshJzruYTsiqTsm4zsu6Qg7KCQ6rKAIOuwjyDtkbjsi5zshJzrsoQg7ISk7KCVCiAgICBmbkNvbmZpZ3VyZVB1c2hTdWIoKSB7CiAgICAgIC8vIHRoaXPsnZgg6rCSIOyehOyLnCDsoIDsnqUKICAgICAgbGV0IHRlbXBfdGhpcyA9IHRoaXMKICAgICAgLy8g7ISc67mE7IqkIOybjOy7pCDsl4bsnLzrqbQg7Iuc7J6R7ZWY7KeAIOyViuydjAogICAgICBpZiAoISgnc2VydmljZVdvcmtlcicgaW4gbmF2aWdhdG9yKSkgewogICAgICAgIGNvbnNvbGUubG9nKCLshJzruYTsiqQg7JuM7Luk6rCAIOyXhuyKteuLiOuLpCEiKQogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIC8vIOyEnOu5hOyKpCDsm4zsu6Qg7KSA67mEIO2ZleyduAogICAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWFkeQogICAgICAgIC50aGVuKGZ1bmN0aW9uIChzd3JlZykgewogICAgICAgICAgLy8g7ZG47IucIOyEnOuyhOyXkOyEnCDqtazrj4XsoJXrs7Qg6rCA7KC47Ji0CiAgICAgICAgICByZXR1cm4gc3dyZWcucHVzaE1hbmFnZXIuZ2V0U3Vic2NyaXB0aW9uKCkKICAgICAgICB9KQogICAgICAgIC50aGVuKGZ1bmN0aW9uIChzdWIpIHsKICAgICAgICAgIGlmIChzdWIgPT09IG51bGwpIHsKICAgICAgICAgICAgLy8g7LKY7J2MIOq1rOuPheydvCDrlYwg7LKY66asCiAgICAgICAgICAgIHRlbXBfdGhpcy5mbk5ld1N1YnNjcmlwdGlvbigpCiAgICAgICAgICAgIHRlbXBfdGhpcy5mbkRpc3BsYXlOb3RpZmljYXRpb24oKQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy8g7J2066+4IOq1rOuPheuQnCDqsr3smrAg7LKY66asCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCfsnbTrr7gg6rWs64+F65CY7Ja0IOyeiOyKteuLiOuLpCEnKQogICAgICAgICAgfQogICAgICAgIH0pCiAgICB9LAogICAgLy8g7IOI66Gc7Jq0IOq1rOuPheyekCDrk7HroZ0g7LKY66asCiAgICBmbk5ld1N1YnNjcmlwdGlvbigpIHsKICAgICAgbGV0IHRlbXBfdGhpcyA9IHRoaXMKICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkKICAgICAgICAudGhlbihmdW5jdGlvbiAoc3dyZWcpIHsKICAgICAgICAgIC8vIOyDiOuhnOyatCDqtazrj4XsnpAg65Ox66Gd7JqpIOqzteqwnO2CpChwdWJsaWMga2V5KSkg7KSA67mECiAgICAgICAgICBjb25zdCB2YXBpZFB1YmxpY0tleSA9CiAgICAgICAgICAgICdCTUNyam9KRFRkSkJRWXA3RFBiVDVkdENPLURseG10Q2E1U3hQM3Z1OFRNbXJRbjNVS3p4ODJvM0xNbERyc3FpUjhCdTJ6U2Npb1Y0YjNnNENlaUJ5ZzAnCiAgICAgICAgICBjb25zdCBjb252ZXJ0ZWRWYXBpZFB1YmxpY0tleSA9CiAgICAgICAgICAgIHRlbXBfdGhpcy51cmxCYXNlNjRUb1VpbnQ4QXJyYXkodmFwaWRQdWJsaWNLZXkpCiAgICAgICAgICAvLyDtkbjsi5wg7ISc67KE7JeQIO2NvOu4lOumre2CpOuhnCDqtazrj4XsoJXrs7Qg65Ox66Gd7ZWoCiAgICAgICAgICByZXR1cm4gc3dyZWcucHVzaE1hbmFnZXIuc3Vic2NyaWJlKHsKICAgICAgICAgICAgdXNlclZpc2libGVPbmx5OiB0cnVlLAogICAgICAgICAgICBhcHBsaWNhdGlvblNlcnZlcktleTogY29udmVydGVkVmFwaWRQdWJsaWNLZXkKICAgICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKG5ld1N1YikgewogICAgICAgICAgICAvLyDsi6Dqt5wg6rWs64+F7J6QIOygleuztCDrs4DtmZggOiDroZzsmrAg642w7J207YSwIOuwsOyXtCA9PiDtlYTthLDrp4HrkJwgSlNPTiA9PiDsoJXrj4jrkJwg67Cw7Je0CiAgICAgICAgICAgIGNvbnN0IGZpbHRlcmVkU3ViID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShuZXdTdWIpKQogICAgICAgICAgICB2YXIgcHVzaENvbmZpZyA9IHsKICAgICAgICAgICAgICBlbmRwb2ludDogZmlsdGVyZWRTdWIuZW5kcG9pbnQsCiAgICAgICAgICAgICAga2V5czogewogICAgICAgICAgICAgICAgcDI1NmRoOiBmaWx0ZXJlZFN1Yi5rZXlzLnAyNTZkaCwKICAgICAgICAgICAgICAgIGF1dGg6IGZpbHRlcmVkU3ViLmtleXMuYXV0aAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDtjIzsnbTslrTrsqDsnbTsiqQgRELsl5Ag6rWs64+F7J6QIOyggOyepQogICAgICAgICAgICByZXR1cm4gb1N1YnNjcmlwdGlvbnNpbkRCLnB1c2gocHVzaENvbmZpZykKICAgICAgICAgIH0pCiAgICAgICAgfSkKICAgIH0sCiAgICAvLyDqtazrj4XsnpAg65Ox66GdIO2VtOygnAogICAgZm5VblN1YnNjcmlwdGlvbigpIHsKICAgICAgbGV0IHRlbXBfdGhpcyA9IHRoaXMKICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkKICAgICAgICAudGhlbihmdW5jdGlvbiAoc3dyZWcpIHsKICAgICAgICAgIHJldHVybiBzd3JlZy5wdXNoTWFuYWdlci5nZXRTdWJzY3JpcHRpb24oKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChvbGRTdWIpIHsKICAgICAgICAgIHRlbXBfdGhpcy5iTXNnID0gdHJ1ZTsKICAgICAgICAgIG9sZFN1Yi51bnN1YnNjcmliZSgpOwogICAgICAgIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKQogICAgfSwKICAgIC8vIO2RuOyLnCDslYzrprwg66mU7Iuc7KeAIOykgOu5hCDrsI8g67Cc7IahCiAgICBmbkRpc3BsYXlOb3RpZmljYXRpb24oKSB7CiAgICAgIGNvbnN0IHRpdGxlID0gJ+yhuOyXheyeke2SiCDsoITsi5ztmownCiAgICAgIGNvbnN0IG9wdGlvbnMgPSB7CiAgICAgICAgYm9keTogJ+yDiOuhnOyatCDshozsi50g7JWM66a8IOyEnOu5hOyKpOyXkCDqsIDsnoXtlZjsi6Ag6rKD7J2EIO2ZmOyYge2VqeuLiOuLpCEnLAogICAgICAgIGljb246ICcvaW1nL3B1c2gtbm90aS5wbmcnLAogICAgICAgIGJhZGdlOiAnL2ltZy9wdXNoLWJhZGdlLWljb24ucG5nJywKICAgICAgICBpbWFnZTogJy9pbWcvcHVzaC1pbWFnZS5qcGcnLAogICAgICAgIGFjdGlvbnM6IFt7CiAgICAgICAgICBhY3Rpb246ICdsaWtlJywKICAgICAgICAgIHRpdGxlOiAn7Luk7ZS866W8IOyii+yVhO2VmOyLnOuptCDrp4Htgazrpbwg7YG066at7ZWY7IS47JqULicsCiAgICAgICAgICBpY29uOiAnL2ltZy9wdXNoLWNvZmZlZS5wbmcnCiAgICAgICAgfV0sCiAgICAgICAgdmlicmF0ZTogWzUwMCwgMTAwLCA1MDBdCiAgICAgIH0KICAgICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkKICAgICAgICAudGhlbihmdW5jdGlvbiAoc3dyZWcpIHsKICAgICAgICAgIC8vIOqwgOyehe2ZmOyYgSDslYzrprwg67Cc7IahCiAgICAgICAgICBzd3JlZy5zaG93Tm90aWZpY2F0aW9uKHRpdGxlLCBvcHRpb25zKQogICAgICAgIH0pCiAgICB9LAogICAgLy8g7L2U65OcIOuTseuhnSDrlYwg7ZWE7JqU7ZWgIOyIq+yekCDsu6jrsoTthLDsmqkg7Jyg7Yu466as7YuwIO2VqOyImAogICAgdXJsQmFzZTY0VG9VaW50OEFycmF5KGJhc2U2NFN0cmluZykgewogICAgICBjb25zdCBwYWRkaW5nID0gJz0nLnJlcGVhdCgoNCAtIGJhc2U2NFN0cmluZy5sZW5ndGggJSA0KSAlIDQpCiAgICAgIGNvbnN0IGJhc2U2NCA9IChiYXNlNjRTdHJpbmcgKyBwYWRkaW5nKQogICAgICAgIC8qIGVzbGludC1kaXNhYmxlICovCiAgICAgICAgLnJlcGxhY2UoL1wtL2csICcrJykKICAgICAgICAvKiBlc2xpbnQtZW5hYmxlICovCiAgICAgICAgLnJlcGxhY2UoL18vZywgJy8nKQogICAgICBjb25zdCByYXdEYXRhID0gd2luZG93LmF0b2IoYmFzZTY0KQogICAgICByZXR1cm4gVWludDhBcnJheS5mcm9tKFsuLi5yYXdEYXRhXS5tYXAoKGNoYXIpID0+CiAgICAgICAgY2hhci5jaGFyQ29kZUF0KDApKSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["subscribe_page.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2CA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"subscribe_page.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n  <v-card class=\"mx-auto\" max-width=\"500\">\r\n    <!-- 상단에 카드 이미지 표시, 파일경로는 assets 기준 -->\r\n    <v-img src=\"../assets/img/push-image.jpg\" height=\"200px\">\r\n    </v-img>\r\n    <v-row align=\"center\">\r\n      <v-col offset=\"1\" cols=\"2\">\r\n        <!-- 좌측에 푸시알림 아이콘 이미지 표시, 파일경로는 public 기준 -->\r\n        <v-img contain color=\"blue darken-2\" src=\"../assets/img/push-noti.png\" max-width=\"70px\"></v-img>\r\n      </v-col>\r\n      <!-- 우측에 안내글 표시 -->\r\n      <v-col cols=\"8\">\r\n        <v-card-title primary-title>\r\n          <h1 class=\"headline\">졸업작품 전시회 푸시알림</h1>\r\n          <div class=\"body-1\"> 졸업작품 전시회의 초청 푸시 알림을 보내려고 합니다.\r\n            [알림허용] 단추를 클릭하시면 알림 정보를 받으실 수\r\n            있습니다. </div>\r\n        </v-card-title>\r\n      </v-col>\r\n    </v-row>\r\n    <v-row align=\"center\">\r\n      <v-col offset=\"1\" cols=\"5\">\r\n        <!-- 하단에 푸시알림 가입 버튼 표시 -->\r\n        <v-btn block large @click=\"fnPushSubscribe\" color=\"orange\" dark>\r\n          <v-icon dark left>add_alert</v-icon>\r\n          알림 허용\r\n        </v-btn>\r\n      </v-col>\r\n      <v-col cols=\"5\">\r\n        <!-- 하단에 푸시알림 해제 버튼 표시 -->\r\n        <v-btn block large @click=\"fnUnSubscription\" color=\"orange\" dark>\r\n          <v-icon dark left>notifications_off</v-icon>\r\n          알림 해제\r\n        </v-btn>\r\n      </v-col>\r\n    </v-row>\r\n    <v-snackbar v-model=\"bMsg\">\r\n      푸시알림이 해제되었습니다.\r\n      <v-btn color=\"orange\" text @click=\"bMsg = false\">닫기</v-btn>\r\n    </v-snackbar>\r\n  </v-card>\r\n</template>\r\n<script>\r\n  // 파이어베이스에서 oSubscriptionsinDB 객체 변수 가져옴\r\n  import {\r\n    oSubscriptionsinDB\r\n  } from '@/datasources/firebase'\r\n\r\n  export default {\r\n    data() {\r\n      return {\r\n        bMsg: false, // 버튼이 눌렸을 때 안내 메시지 표시여부\r\n      }\r\n    },\r\n    methods: {\r\n      fnPushSubscribe() {\r\n        // this의 값 임시 저장\r\n        let temp_this = this\r\n        // 사용자에게 푸시 사용할지 허가 요청\r\n        Notification.requestPermission(function (result) {\r\n          if (result !== 'granted') {\r\n            console.log('푸시알림 기능이 허용되지 않았습니다!')\r\n          } else {\r\n            // 사용자가 허가하면 푸시알림 서비스 설정 실행\r\n            temp_this.fnConfigurePushSub()\r\n          }\r\n        })\r\n      },\r\n      // 푸시알림을 위해 서비스워커 점검 및 푸시서버 설정\r\n      fnConfigurePushSub() {\r\n        // this의 값 임시 저장\r\n        let temp_this = this\r\n        // 서비스 워커 없으면 시작하지 않음\r\n        if (!('serviceWorker' in navigator)) {\r\n          console.log(\"서비스 워커가 없습니다!\")\r\n          return\r\n        }\r\n        // 서비스 워커 준비 확인\r\n        navigator.serviceWorker.ready\r\n          .then(function (swreg) {\r\n            // 푸시 서버에서 구독정보 가져옴\r\n            return swreg.pushManager.getSubscription()\r\n          })\r\n          .then(function (sub) {\r\n            if (sub === null) {\r\n              // 처음 구독일 때 처리\r\n              temp_this.fnNewSubscription()\r\n              temp_this.fnDisplayNotification()\r\n            } else {\r\n              // 이미 구독된 경우 처리\r\n              console.log('이미 구독되어 있습니다!')\r\n            }\r\n          })\r\n      },\r\n      // 새로운 구독자 등록 처리\r\n      fnNewSubscription() {\r\n        let temp_this = this\r\n        navigator.serviceWorker.ready\r\n          .then(function (swreg) {\r\n            // 새로운 구독자 등록용 공개키(public key)) 준비\r\n            const vapidPublicKey =\r\n              'BMCrjoJDTdJBQYp7DPbT5dtCO-DlxmtCa5SxP3vu8TMmrQn3UKzx82o3LMlDrsqiR8Bu2zScioV4b3g4CeiByg0'\r\n            const convertedVapidPublicKey =\r\n              temp_this.urlBase64ToUint8Array(vapidPublicKey)\r\n            // 푸시 서버에 퍼블릭키로 구독정보 등록함\r\n            return swreg.pushManager.subscribe({\r\n              userVisibleOnly: true,\r\n              applicationServerKey: convertedVapidPublicKey\r\n            }).then(function (newSub) {\r\n              // 신규 구독자 정보 변환 : 로우 데이터 배열 => 필터링된 JSON => 정돈된 배열\r\n              const filteredSub = JSON.parse(JSON.stringify(newSub))\r\n              var pushConfig = {\r\n                endpoint: filteredSub.endpoint,\r\n                keys: {\r\n                  p256dh: filteredSub.keys.p256dh,\r\n                  auth: filteredSub.keys.auth\r\n                }\r\n              }\r\n              // 파이어베이스 DB에 구독자 저장\r\n              return oSubscriptionsinDB.push(pushConfig)\r\n            })\r\n          })\r\n      },\r\n      // 구독자 등록 해제\r\n      fnUnSubscription() {\r\n        let temp_this = this\r\n        navigator.serviceWorker.ready\r\n          .then(function (swreg) {\r\n            return swreg.pushManager.getSubscription();\r\n          }).then(function (oldSub) {\r\n            temp_this.bMsg = true;\r\n            oldSub.unsubscribe();\r\n          }).catch(err => console.log(err))\r\n      },\r\n      // 푸시 알림 메시지 준비 및 발송\r\n      fnDisplayNotification() {\r\n        const title = '졸업작품 전시회'\r\n        const options = {\r\n          body: '새로운 소식 알림 서비스에 가입하신 것을 환영합니다!',\r\n          icon: '/img/push-noti.png',\r\n          badge: '/img/push-badge-icon.png',\r\n          image: '/img/push-image.jpg',\r\n          actions: [{\r\n            action: 'like',\r\n            title: '커피를 좋아하시면 링크를 클릭하세요.',\r\n            icon: '/img/push-coffee.png'\r\n          }],\r\n          vibrate: [500, 100, 500]\r\n        }\r\n        navigator.serviceWorker.ready\r\n          .then(function (swreg) {\r\n            // 가입환영 알림 발송\r\n            swreg.showNotification(title, options)\r\n          })\r\n      },\r\n      // 코드 등록 때 필요할 숫자 컨버터용 유틸리티 함수\r\n      urlBase64ToUint8Array(base64String) {\r\n        const padding = '='.repeat((4 - base64String.length % 4) % 4)\r\n        const base64 = (base64String + padding)\r\n          /* eslint-disable */\r\n          .replace(/\\-/g, '+')\r\n          /* eslint-enable */\r\n          .replace(/_/g, '/')\r\n        const rawData = window.atob(base64)\r\n        return Uint8Array.from([...rawData].map((char) =>\r\n          char.charCodeAt(0)))\r\n      }\r\n    }\r\n  }\r\n</script>"]}]}